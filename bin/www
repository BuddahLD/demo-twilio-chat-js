#!/usr/bin/env node

const http = require('http');
const app = require('../app');
const cache = require('../services/cache');
const logger = require('../services/logger');
const package = require('../package.json');
const port = process.env.PORT || 3000;
const gitCommit = process.env.GIT_COMMIT || 'latest';

const server = http.createServer(app);

server.listen(port, () => {
	logger.info(`${package.name} v${package.version} (@${gitCommit}) listening on ${port}...`);
});

process.on('SIGINT', () => {
	logger.info('Shutdown started');
	server.close(() => {
		cache.end();
		logger.info('Process is stopping');
	});
});